type Address {
	id: ID! @unique
	street: String
	city: String
	postalCode: String
	country: String
}

enum Title {
	MONSIEUR
	MADAME
	MADEMOISELLE
	MONDAMOISEAU
}

# Represents a company or an individual that is going to receive an invoice
type Customer {
	id: ID! @unique
	token: String @unique
	name: String
	title: Title
	firstName: String
	lastName: String
	email: String!
	address: Address
	phone: String
	siret: String
	rcs: String
	rm: String
	serviceCompany: Company! @relation(name: "CompanyCustomers")
	quotes: [Quote!]! @relation(name: "CustomerQuotes")
	projects: [Project]! @relation(name: "CustomerProjects")
	linkedTasks: [Item]! @relation(name: "LinkedCustomerTasks")
	commentViews: [CommentView!]! @relation(name: "CommentViewCustomer")
}

enum QuoteStatus {
	DRAFT
	SENT
	ACCEPTED
	REJECTED
	INVOICED
	INVOICED_ACCEPTED
}

enum QuoteTemplate {
	BLANK
	WEBSITE
	IDENTITY
}

enum ProjectStatus {
	DRAFT
	ONGOING
	FINISHED
}

enum ProjectTemplate {
	BLANK
	WEBSITE
	IDENTITY
}

enum ItemStatus {
	PENDING
	SNOOZED
	FINISHED

	# deprecated statuses
	UPDATED
	UPDATED_SENT
	ADDED
	ADDED_SENT
}

enum ReminderType {
	QUOTE_AFTER_10_DAYS
	QUOTE_AFTER_15_DAYS
	QUOTE_AFTER_20_DAYS
	QUOTE_5_DAYS_LEFT
	QUOTE_2_DAYS_LEFT
	AMENDMENT_AFTER_5_DAYS
	AMENDMENT_AFTER_10_DAYS

	# 2 day reminder
	FIRST
	# FIRST + days reminder
	SECOND
	# SECOND + 1 days reminder
	LAST

	# customer has not replied, user warning at LAST + 2 days
	USER_WARNING

	# Morning email with tasks the user can complete
	MORNING_TASKS
	# Evening email with what happened during the day
	EVENING_RECAP

	# End of a snooze period
	SNOOZE_END
}

enum ReminderStatus {
	PENDING
	SENT
	ERROR
	CANCELED
}

enum JobType {
	TEAM
	FULLTIME_INDIVIDUAL
	PARTTIME_INDIVIDUAL
	NOT_FREELANCER
}

enum Reviewer {
	USER
	CUSTOMER
}

enum DAY {
	MONDAY
	TUESDAY
	WEDNESDAY
	THURSDAY
	FRIDAY
	SATURDAY
	SUNDAY
}

enum UserEventType {
	ME_CALL
}

type CommentView {
	id: ID! @unique
	user: User @relation(name: "CommentViewUser")
	customer: Customer @relation(name: "CommentViewCustomer")
	comment: Comment @relation(name: "CommentViews")
	createdAt: DateTime!
}

type Comment {
	id: ID! @unique
	text: String!
	authorUser: User
	authorCustomer: Customer
	viewedByUser: Boolean! @default(value: false)
	viewedByCustomer: Boolean! @default(value: false)
	views: [CommentView!]! @relation(name: "CommentViews", onDelete: CASCADE)
	item: Item! @relation(name: "ItemComments")
	createdAt: DateTime!
}

enum ItemType {
	DEFAULT
	CUSTOMER
	CONTENT_ACQUISITION
	CUSTOMER_REMINDER
	VALIDATION
	USER_REMINDER
}

type Item {
	id: ID! @unique
	owner: User @relation(name: "UserTasks")
	linkedCustomer: Customer @relation(name: "LinkedCustomerTasks")
	name: String!
	type: ItemType! @default(value: DEFAULT)
	description: String @default(value: "")
	unit: Float @default(value: 0)
	comments: [Comment!]! @relation(name: "ItemComments", onDelete: CASCADE)
	status: ItemStatus! @default(value: PENDING)
	section: Section @relation(name: "SectionItems")
	reviewer: Reviewer! @default(value: USER)
	reminders: [Reminder!]! @relation(name: "ItemReminders", onDelete: CASCADE)
	snoozedUntil: Reminder @relation(name: "SnoozeReminders", onDelete: CASCADE)
	finishedAt: DateTime
	position: Int!
	dueDate: DateTime
	createdAt: DateTime!
	updatedAt: DateTime!
	timeItTook: Float
}

type Section {
	id: ID! @unique
	name: String!
	items: [Item!]! @relation(name: "SectionItems", onDelete: CASCADE)
	option: Option @relation(name: "OptionSections")
	project: Project @relation(name: "ProjectSections")
	position: Int!
}

type Option {
	id: ID! @unique
	name: String!
	proposal: Json! @default(value: "{}")
	sections: [Section!]! @relation(name: "OptionSections", onDelete: CASCADE)
	quote: Quote! @relation(name: "QuoteOptions")
}

type Quote {
	id: ID! @unique
	name: String!
	template: QuoteTemplate @default(value: BLANK)
	customer: Customer! @relation(name: "CustomerQuotes")
	# this token is a way to restrict access to anyone else than the customer
	token: String! @unique
	status: QuoteStatus! @default(value: DRAFT)
	options: [Option!]! @relation(name: "QuoteOptions", onDelete: CASCADE)
	viewedByCustomer: Boolean! @default(value: false)
	reminders: [Reminder!]! @relation(name: "QuoteReminders", onDelete: CASCADE)
	issuedAt: DateTime
	createdAt: DateTime!
	updatedAt: DateTime!

	acceptedQuotesLogs: [Log!]!
		@relation(name: "AcceptedQuotesLogs", onDelete: CASCADE)
	acceptedAmendmentsLogs: [Log!]!
		@relation(name: "AcceptedAmendmentsLogs", onDelete: CASCADE)
}

type Project {
	id: ID! @unique
	name: String!
	template: ProjectTemplate @default(value: BLANK)
	customer: Customer @relation(name: "CustomerProjects")
	# this token is a way to restrict access to anyone else than the customer
	token: String! @unique
	status: ProjectStatus! @default(value: DRAFT)
	sections: [Section!]! @relation(name: "ProjectSections", onDelete: CASCADE)
	viewedByCustomer: Boolean! @default(value: false)
	issuedAt: DateTime
	deadline: DateTime
	notifyActivityToCustomer: Boolean! @default(value: true)
	createdAt: DateTime!
	updatedAt: DateTime!
}

type Company {
	id: ID! @unique
	name: String
	owner: User! @relation(name: "CompanyOwner")
	email: String
	address: Address
	phone: String
	type: String
	siret: String
	rcs: String
	rcsCity: String
	rm: String
	vat: String
	logo: File @relation(name: "CompanyLogo", onDelete: CASCADE)
	customers: [Customer!]! @relation(name: "CompanyCustomers", onDelete: CASCADE)
}

type Settings {
	user: User! @relation(name: "UserSettings")
	askItemFinishConfirmation: Boolean! @default(value: true)
	askSendQuoteConfirmation: Boolean! @default(value: true)
	askStartProjectConfirmation: Boolean! @default(value: true)
}

type User {
	id: ID! @unique
	email: String! @unique
	hmacIntercomId: String
	password: String!
	firstName: String!
	lastName: String!
	company: Company! @relation(name: "CompanyOwner", onDelete: CASCADE)
	startWorkAt: DateTime
	endWorkAt: DateTime
	workingDays: [DAY!]!
	timeZone: String
	userEvents: [UserEvent!]! @relation(name: "UserUserEvents", onDelete: CASCADE)
	morningReminders: [Reminder!]!
		@relation(name: "UserMorningReminders", onDelete: CASCADE)
	eveningReminders: [Reminder!]!
		@relation(name: "UserEveningReminders", onDelete: CASCADE)
	defaultDailyPrice: Int @default(value: 350)
	defaultVatRate: Int @default(value: 20)
	commentViews: [CommentView!]! @relation(name: "CommentViewUser")
	workingFields: [String!]!
	jobType: JobType
	interestedFeatures: [String!]!
	hasUpcomingProject: Boolean
	settings: Settings! @relation(name: "UserSettings")
	tasks: [Item!]! @relation(name: "UserTasks", onDelete: CASCADE)
	createdAt: DateTime!
	updatedAt: DateTime!
}

type Reminder {
	id: ID! @unique
	quote: Quote @relation(name: "QuoteReminders")
	item: Item @relation(name: "ItemReminders")
	morningRemindersUser: User @relation(name: "UserMorningReminders")
	eveningRemindersUser: User @relation(name: "UserEveningReminders")
	snoozedItem: Item @relation(name: "SnoozeReminders")
	postHookId: String!
	type: ReminderType!
	sendingDate: DateTime!
	status: ReminderStatus @default(value: PENDING)
}

type Log {
	ip: String!
	acceptedQuotes: [Quote!]! @relation(name: "AcceptedQuotesLogs")
	acceptedAmendments: [Quote!]! @relation(name: "AcceptedAmendmentsLogs")
	createdAt: DateTime!
}

type File {
	id: ID! @unique
	filename: String!
	mimetype: String!
	encoding: String!
	url: String!
	createdAt: DateTime!
}

type UserEvent {
	id: ID! @unique
	type: UserEventType!
	createdAt: DateTime!
	user: User @relation(name: "UserUserEvents")
}
