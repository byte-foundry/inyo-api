type Address {
  street: String
  city: String
  postalCode: String
  country: String
}

# Represents a company or an individual that is going to receive an invoice
type Customer {
  id: ID! @unique
  name: String
  firstName: String
  lastName: String
  email: String!
  address: Address
  phone: String
  siret: String
  rcs: String
  rm: String
}

enum QuoteStatus {
  DRAFT
  INVOICE_SENT
  INVOICE_ACCEPTED
  REJECTED
  INVOICED
  INVOICED_VALIDATED
}

enum QuoteTemplate {
  WEBSITE
  IDENTITY
}

enum ItemStatus {
  PENDING
  FINISHED
  UPDATED
  UPDATED_SENT
}

enum ReminderType {
  QUOTE_AFTER_1MONTH
  QUOTE_AFTER_2MONTH
  QUOTE_20_DAYS_LEFT
  QUOTE_10_DAYS_LEFT
  QUOTE_5_DAYS_LEFT
  AMENDMENT_AFTER_5_DAYS
  AMENDMENT_AFTER_10_DAYS
}

enum ReminderStatus {
  PENDING
  SENT
  ERROR
}

# Until unions are supported
type Author {
  user: User
  customer: Customer
}

type Comment {
  id: ID! @unique
  value: String!
  author: Author!
}

type Item {
  id: ID! @unique
  name: String!
  description: String @default(value: "")
  unitPrice: Int! @default(value: 0)
  # when unit has been changed but not yet validated
  pendingUnit: Int
  unit: Int @default(value: 0)
  comments: [Comment!]!
  vatRate: Int! @default(value: 0)
  status: ItemStatus! @default(value: "PENDING")
  section: Section! @relation(name: "SectionItems")
}

type Section {
  id: ID! @unique
  name: String!
  items: [Item!]! @relation(name: "SectionItems", onDelete: CASCADE)
  option: Option! @relation(name: "OptionSections")
}

type Option {
  id: ID! @unique
  name: String!
  proposal: Json! @default(value: "{}")
  sections: [Section!]! @relation(name: "OptionSections", onDelete: CASCADE)
  quote: Quote! @relation(name: "QuoteOptions")
}

type Quote {
  id: ID! @unique
  name: String!
  template: QuoteTemplate
  issuer: Company! @relation(name: "CompanyQuotes")
  customer: Customer!
  # this token is a way to restrict access to anyone else than the customer
  token: String!
  status: QuoteStatus! @default(value: "DRAFT")
  options: [Option!]! @relation(name: "QuoteOptions", onDelete: CASCADE)
  viewedByCustomer: Boolean! @default(value: false)
  issuedAt: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Company {
  id: ID! @unique
  name: String
  owner: User! @relation(name: "CompanyOwner")
  email: String
  address: Address
  phone: String
  siret: String
  rcs: String
  rm: String
  vat: String
  customers: [Customer!]!
  quotes: [Quote!]! @relation(name: "CompanyQuotes")
}

type User {
  id: ID! @unique
  email: String! @unique
  password: String!
  firstName: String
  lastName: String
  company: Company! @relation(name: "CompanyOwner")
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Reminder {
  id: ID! @unique
  quote: Quote! @relation(name: "QuoteReminders")
  postHookId: String!
  type: ReminderType!
  sendingDate: DateTime!
  status: ReminderStatus
}
