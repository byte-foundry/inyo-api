type Address {
  street: String
  city: String
  postalCode: String
  country: String
}

# Represents a company or an individual that is going to receive an invoice
type Customer {
  id: ID! @unique
  name: String
  firstName: String
  lastName: String
  email: String!
  address: Address
  phone: String
  siret: String
  rcs: String
  rm: String
}

enum QuoteStatus {
  DRAFT
  INVOICE_SENT
  INVOICE_ACCEPTED
  REJECTED
  INVOICED
  INVOICED_VALIDATED
}

enum QuoteTemplate {
  WEBSITE
  IDENTITY
}

enum ItemStatus {
  PENDING
  FINISHED
  UPDATED
  UPDATED_SENT
}

enum Unit {
  TIME
}

# Until unions are supported
type Author {
  user: User
  customer: Customer
}

type Comment {
  id: ID! @unique
  value: String!
  author: Author!
}

type Item {
  id: ID! @unique
  name: String!
  unitPrice: Int! @default(value: 0)
  # when unit has been changed but not yet validated
  pendingUnitPrice: Int
  unit: Unit! @default(value: "TIME")
  comments: [Comment!]!
  vatRate: Int! @default(value: 0)
  status: ItemStatus! @default(value: "PENDING")
}

type Section {
  id: ID! @unique
  name: String!
  items: [Item!]! @relation(name: "SectionItems", onDelete: CASCADE)
}

type Option {
  id: ID! @unique
  name: String!
  proposal: String
  sections: [Section!]! @relation(name: "OptionSections", onDelete: CASCADE)
}

type Quote {
  id: ID! @unique
  name: String!
  template: QuoteTemplate
  issuer: Company! @relation(name: "CompanyQuotes")
  customer: Customer!
  # this token is a way to restrict access to anyone else than the customer
  token: String!
  status: QuoteStatus! @default(value: "DRAFT")
  options: [Option!]! @relation(name: "QuoteOptions", onDelete: CASCADE)
  viewedByCustomer: Boolean! @default(value: false)
  issuedAt: DateTime
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Company {
  id: ID! @unique
  name: String
  owner: User! @relation(name: "CompanyOwner")
  email: String
  address: Address
  phone: String
  siret: String
  rcs: String
  rm: String
  vat: String
  customers: [Customer!]!
  quotes: [Quote!]! @relation(name: "CompanyQuotes")
}

type User {
  id: ID! @unique
  email: String! @unique
  password: String!
  firstName: String
  lastName: String
  company: Company! @relation(name: "CompanyOwner")
  createdAt: DateTime!
  updatedAt: DateTime!
}
